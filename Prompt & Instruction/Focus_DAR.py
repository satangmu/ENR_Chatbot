import os
import pandas as pd
from langchain.chat_models import AzureChatOpenAI
from langchain.prompts import ChatPromptTemplate, FewShotChatMessagePromptTemplate
from langchain.schema import HumanMessage, AIMessage

# Azure OpenAI를 사용하는 객체 생성
chat = AzureChatOpenAI(
    deployment_name='배포이름',
    model_name='모델이름',
    temperature=0.5
)



# 기본 프롬프트 템플릿 생성
example_prompt = ChatPromptTemplate.from_messages(
    [
        ("human", "{input}"),
        ("ai", "{output}"),
    ]
)


# 예시 데이터
examples = [
    {"input": "비효과적 호흡 양상 환자의 간호기록을 Focus DAR 양식으로 작성해줘.", "output":  "환자 정보:\n이름: 정태호  \n나이: 70세  \n성별: 남성  \n\nFocus: 비효과적 호흡 및 피로감  \n\nData:\n 환자는 지속적인 호흡곤란을 호소하며, 작은 노력에도 호흡이 어려워짐.\n 호흡수: 26 rpm\n 심박수: 95 bpm\n 환자는 활동 시 피로감을 경험하며, 흉부에서 졸음을 어려워하는 증상이 나타남.\n 산소 포화도: 88% (공기 중 산소 투입 후)\n 의사의 진단에 따라 폐 기능 검사에서 기도 폐쇄성 질환 확인.\n\nAction:\n1. 비효과적 호흡의 원인을 확인하기 위해 의사의 지시에 따라 폐 기능 검사 및 영상 검사 수행.\n2. 의사의 처방에 따라 적절한 호흡 보조기기 사용 및 산소 공급 방식 조절.\n3. 활동 시 피로감을 관리하기 위해 물리치료사와 협력하여 활동 감량 및 호흡 훈련 계획 수립.\n4. 환자와 가족에게 기도 폐쇄성 질환에 대한 교육 제공.\n5. 산소 포화도 및 호흡수 주기적인 평가를 통해 의사에게 환자 상태 보고.\n\nResponse:\n 폐 기능 검사 및 영상 검사 결과를 토대로 비효과적 호흡의 원인을 확인하고, 적절한 치료 계획이 수립됨.\n 호흡 보조기기 사용과 산소 공급 방식의 조절로 호흡수가 20 rpm로 개선되며, 피로감이 감소함.\n 물리치료 및 활동 훈련을 통해 환자는 피로에 대한 관리능력이 향상되고, 활동 감량을 경험함.\n 환자와 가족은 기도 폐쇄성 질환에 대한 이해가 높아지고, 환자는 적절한 자가 관리를 실시함."},
    {"input": "비효과적 기도 청결 환자의 간호기록을 Focus DAR 양식으로 작성해줘.", "output": "환자 정보:\n이름: 이동철  \n나이: 58세  \n성별: 남성  \n\nFocus: 비효과적 기도 청결 및 구강 건강 관리  \n\nData:\n 환자는 입마비로 인해 건조한 입안을 호소하며, 기도 소리와 함께 입안에서 분비물이 증가함.\n 구강 검진 결과에 따르면 치아와 치주 상태가 악화되어 치아 감염 및 치주염이 나타남.\n 식사 후 입안의 청결감이 떨어져서 음식물 잔여물이 남아있음.\n 호흡 소리와 함께 발음이 불분명해지고 있음.\n\nAction:\n1. 비효과적 기도 청결의 원인을 찾기 위해 환자의 구강 상태를 검사하고, 구강 위생사와의 협력을 통한 추가적인 평가 실시.\n2. 치주 치료 및 치아 관리 계획 수립하여 환자에게 제공하고, 칫솔 및 치실 사용법 교육 실시.\n3. 입안의 건조를 완화하기 위해 입안 윤활제 및 치주 관리제 처방.\n4. 물리치료 및 맞춤형 기도 운동 프로그램 시작하여 비효과적인 기도 청결을 개선.\n5. 환자와 가족에게 정기적인 치과 검진 및 치료의 중요성, 입안 건강 유지를 위한 생활 습관 교육 제공.\n\nResponse:\n 치주 치료 및 치아 관리 계획에 따라 치아와 치주 상태가 안정화되며, 입안의 건조 증상이 감소함.\n 구강 위생사와의 협력을 통해 올바른 치아 관리 방법을 습득하고, 치주 관리제와 입안 윤활제의 사용법을 익힘.\n 물리치료 및 기도 운동 프로그램을 통해 호흡 소리와 입안 분비물이 감소하고, 발음이 더 명확해짐.\n 환자와 가족은 입안 건강의 중요성을 이해하고, 구강 건강 유지를 위해 꾸준한 관리 및 정기적인 치과 검진을 실천함."},
    {"input": "가스교환 장애 환자의 간호기록을 Focus DAR 양식으로 작성해줘.", "output": "환자 정보:\n이름: 박현우  \n나이: 65세  \n성별: 남성  \n\nFocus: 가스교환 장애 및 만성 폐쇄성 폐질환(COPD) 관리  \n\nData:\n 환자는 30년 이상의 흡연 경력이 있으며, 흡연량이 매우 높음.\n 호흡곤란, 기침, 가슴 통증이 주증상으로 나타나고 있음.\n 산소 포화도: 88% (휴식 상태에서)\n 호흡수: 24 rpm\n 심박수: 95 bpm\n 의사의 진단에 따라 COPD로 확인되었으며, 기도 폐쇄성 질환의 중증도가 높음.\n\nAction:\n1. 산소 포화도 및 폐 기능 검사를 통해 기도 폐쇄성 질환의 정도를 평가하고, 의사의 처방에 따라 치료 계획 수립.\n2. 흡연 관리 프로그램에 참여하도록 환자를 유도하고, 금연을 돕는 치료와 교육을 제공.\n3. 호흡 운동 및 기침 훈련을 포함한 물리치료를 통해 환자의 폐 기능을 최적화하고, 호흡 기술을 개선.\n4. 의사의 지시에 따라 산소 치료 시작 및 관리, 폐 확장제 및 기타 기도 확장제 처방.\n5. 환자와 가족에게 금연, 산소 치료 사용, 정기적인 행동 변화를 통한 건강한 생활 습관의 중요성에 대한 교육 제공.\n\nResponse:\n 적절한 치료 계획 및 산소 치료에 따라 산소 포화도가 95%로 향상되며, 호흡수가 20 rpm으로 감소함.\n 흡연을 중단하고 효과적인 물리치료 및 기도 확장제 사용에 따라 호흡 기능이 향상되고 기침 증상이 감소함.\n 환자는 산소 치료 및 약물 복용에 적극적으로 참여하고, 흡연을 포함한 건강 위험을 인식하여 생활 습관을 개선함.\n 가족은 환자의 건강 상태를 이해하고, 치료 계획과 교육 내용을 지원하여 환자의 삶의 질을 향상시키는 데 기여함."},
    {"input": "낙상 환자의 간호기록을 Focus DAR 양식으로 작성해줘.", "output":  "환자 정보:\n 이름: 김영철  \n나이: 72세  \n성별: 남성  \n\nFocus: 낙상 및 관련된 골절  \n\nData:\n 2023년 11월 15일 오후 14:30에 화장실에서 발생한 낙상.\n 환자는 욕실에서 발견되며, 오른쪽 골반 부위에 통증을 호소함.\n X-ray 상으로 오른쪽 대퇴부골 경골 부분의 골절 확인.\n 통증 점수: 8/10 (0-10점 척도)\n 혈압: 140/85 mmHg\n 심박수: 90 bpm\n 호흡수: 20 rpm\n\nAction:\n1. 통증 관리를 위해 의사의 처방에 따라 진통제 투여.\n2. 골절 부위에 손상을 최소화하기 위해 환자 이동 및 전송 시 주의를 기울임.\n3. 물리치료팀과 협력하여 골절 부위 주변 근육 강화 및 운동 치료 계획 수립.\n4. 환자와 가족에게 낙상 예방 및 안전한 이동 방법에 대한 교육 제공.\n5. 골절 부위의 피부 상태를 지속적으로 평가하여 감염 및 피부 손상 방지.\n\nResponse:\n 통증 관리 계획에 따라 통증이 감소하고, 통증 점수가 3/10으로 개선됨.\n 물리치료를 통해 환자의 운동 능력이 향상되며, 골절 부위 주변 근육 강화.\n 환자는 낙상 예방을 위한 안전한 환경 조성에 동참하며, 안전한 이동 및 활동 참여.\n 골절 부위의 피부 상태가 안정되며, 추가적인 합병증이 없음."},
    {"input": "불안정한 혈압의 위험 환자의 간호기록을 Focus DAR 양식으로 작성해줘.", "output": "환자 정보:\n이름: 정미경  \n나이: 55세  \n\n\n성별: 여성  \n\nFocus: 불안정한 혈압 및 당뇨 관리  \n\nData:\n 초기 혈압 측정에서 고혈압 진단 (170/95 mmHg).\n 당뇨 진단으로 인해 혈당 수치가 일정 수준을 유지하지 못함 (평균 200 mg/dL).\n 심박수: 75 bpm\n 환자는 체중 관리의 어려움을 호소하며, 증상 발생 시간대에 혈압 상승 및 당뇨 증상 악화.\n 의사의 진단에 따라 고혈압과 당뇨에 의한 심혈관 위험 요인이 있음.\n\nAction:\n1. 초기 혈압 측정 후 의사의 지시에 따라 추가적인 혈압 모니터링을 시행하고 결과를 기록.\n2. 혈압 및 당뇨 관리를 위해 의사의 처방에 따라 안티하이퍼텐시브 약물 및 혈당 조절제 처방.\n3. 영양사와 협력하여 적절한 식단 및 체중 관리 계획 수립.\n4. 환자에게 혈압 및 혈당 모니터링의 중요성을 강조하고, 증상 발생 시 즉각적인 조치를 취할 수 있도록 교육 제공.\n5. 가족과 함께 고혈압과 당뇨의 심혈관 위험을 공유하고, 가족의 지원을 통해 건강한 생활 습관을 유지하도록 도움.\n\nResponse:\n 혈압 관리를 위한 처방 약물과 혈당 조절제의 효과로 혈압이 130/80 mmHg로 감소하고, 혈당 수치가 안정화됨.\n 영양사와의 협력으로 식단 및 체중 관리가 개선되어 환자는 건강한 체중을 유지할 수 있음.\n 환자는 혈압 및 혈당의 주기적인 모니터링을 통해 증상의 조절에 성공하고, 적극적인 관리 참여를 보임.\n 가족은 환자의 상태를 이해하고 지원하는 역할을 수행하여 가정 내 건강한 환경을 조성함."},
    {"input": "근육의 긴장 환자의 간호기록을 Focus DAR 양식으로 작성해줘.", "output": "환자 정보:\n이름: 김지은  \n나이: 35세  \n성별: 여성  \n\nFocus: 근육의 긴장 및 통증 관리  \n\nData:\n 환자는 과로와 스트레스로 인해 계속된 고강도 운동으로 근육의 긴장과 통증을 느끼고 있음.\n 특히 하체와 허리 부분에서 근육의 긴장과 통증이 심하게 나타남.\n 통증 부위에서 느껴지는 긴장이 물리적인 활동에 제한을 주고 있음.\n 통증의 정도는 1-10점 척도에서 8점으로 평가됨.\n\nAction:\n1. 근육의 긴장과 통증의 원인을 파악하기 위해 환자의 운동 습관과 일상 생활 환경을 평가.\n2. 물리치료사와의 협력을 통해 근육의 긴장을 완화하고, 통증 관리 계획 수립.\n3. 안정적이고 규칙적인 운동 프로그램 개시하여 근육의 강화 및 유연성 향상을 목표로 함.\n4. 통증 완화를 위한 의사의 처방에 따라 약물 복용 및 올바른 자세 교육 제공.\n5. 스트레스 해소를 위한 정기적인 휴식과 식이 교육을 통해 건강한 생활 습관을 형성.\n\nResponse:\n 물리치료 및 운동 프로그램에 따라 근육의 긴장이 완화되고, 통증 정도가 8점에서 4점으로 감소함.\n 근육 강화와 유연성 향상을 통해 하체와 허리 부분의 근육 경직이 완화되어 물리적인 활동이 원활해짐.\n 통증 관리를 위한 의사의 처방에 따라 적절한 약물을 복용하며, 올바른 자세와 스트레칭 방법을 습득함.\n 환자는 정기적인 운동과 휴식을 통해 스트레스를 완화하고, 건강한 생활 습관을 유지하여 통증을 예방함."},
    {"input": "abdomen pain NRS 7점 환자의 간호기록을 Focus DAR 양식으로 작성해줘.", "output": "환자 정보:\n이름: 이영실  \n나이: 45세  \n성별: 여성  \n\nFocus: 중하부 복통(NRS 9점) 및 소화기 문제 관리  \n\nData:\n 환자는 중하부 복통을 주소로 NRS(Numeric Rating Scale)로 측정한 결과, 9점의 강도로 평가됨.\n 복통은 지속적으로 나타나며, 특히 식사 후에 증가하는 경향이 있음.\n 소화기 증상으로 속쓰림, 소화불량, 구역 등이 동반되며, 식사 후에 특히 가슴부위에서 통증이 발생함.\n 식사 중에도 불쾌한 증상이 나타나어 음식 섭취가 어려워지고, 체중이 감소하고 있음.\n\nAction:\n1. 복통의 원인을 파악하기 위해 환자의 식생활 습관, 약물 복용 여부, 기존 질환 여부를 상세히 조사.\n2. 의사의 지시에 따라 위부 초음파 및 내시경 검사를 실시하여 소화기 관련 문제를 진단하고, 검사 결과를 기록.\n3. 통증 관리를 위해 의사의 처방에 따라 통증 완화제 및 위산억제제 처방.\n4. 영양사와의 협력을 통해 소화기 질환에 적합한 식사 계획 및 영양 공급 계획 수립.\n5. 환자와 가족에게 식이요법 및 생활 습관의 중요성에 대한 교육을 제공하고, 필요한 심리적 지원을 제공.\n\nResponse:\n 위부 초음파 및 내시경 검사 결과, 위식도염 및 위염으로 인한 염증이 확인되어 적절한 치료 시작.\n 통증 완화제와 위산억제제의 효과로 복통의 강도가 9점에서 4점으로 감소하며, 식사 후의 불편감이 개선됨.\n 영양사와의 협력을 통해 식사 계획 및 영양 공급이 개선되어 체중 감소가 멈추고, 올바른 식습관을 유지함.\n 환자와 가족은 소화기 질환에 대한 이해가 높아져 식이요법 및 생활 습관 개선에 적극 참여하고 있음.\n 향후 추적 관찰과 치료의 지속적인 평가를 통해 환자의 상태를 계속해서 모니터링함."},
    {"input": "외상성 지주막하 출혈 환자의 간호기록을 Focus DAR 양식으로 작성해줘.", "output": "환자 정보:\n이름: 김영희  \n나이: 42세  \n성별: 여성  \n\nFocus: 외상성 지주막하 출혈 및 통증 관리  \n\nData:\n 환자는 작업 중 발생한 높은 고도에서 떨어지는 사고로 인해 머리와 목 부위에 강한 충격을 입음.\n CT 검사 결과 외상성 지주막하 출혈이 확인되며, 응급 수술을 받은 후 현재는 의식이 회복되었으나 통증이 심함.\n 통증은 주로 두통 및 목 부위에서 발생하며, 통증의 강도는 1-10점 척도에서 8점으로 평가됨.\n 환자는 통증으로 인해 피곤하고 불안한 감정을 표현하고 있음.\n\nAction:\n1. 통증의 원인을 확인하고, 의사의 지시에 따라 통증 완화제 및 항염증제를 처방.\n2. 환자와의 대화를 통해 통증의 강도와 특징을 상세하게 평가하고, 필요한 경우 추가적인 진통제를 고려.\n3. 물리치료사와의 협력을 통해 목 부위의 근육을 안정시키고, 통증 완화를 위한 운동 프로그램 시작.\n4. 심리치료사와의 상담을 통해 통증으로 인한 정서적인 어려움을 해소하고, 정서적 지원을 제공.\n5. 환자의 피드백을 지속적으로 수용하며, 필요한 경우 통증 관리 계획을 조절하여 최적의 효과를 도모.\n\nResponse:\n 통증 완화제 및 항염증제의 투여로 통증의 강도가 8점에서 4점으로 감소하며, 두통과 목 부위의 통증이 완화됨.\n 물리치료를 통해 목 부위의 근육이 안정화되고, 운동 프로그램에 참여함으로써 통증 완화 효과를 높임.\n 심리치료를 통해 환자의 정서적인 불안과 피로감이 감소하고, 효과적인 대처 방법을 습득함.\n 환자는 통증에 대한 개선을 체감하며, 신체적, 정신적인 안정을 향해 진전함."},
    {"input": "아침 식후 고혈당 환자의 간호기록을 Focus DAR 양식으로 작성해줘.", "output": "환자 정보:\n이름: 김지영  \n나이: 65세  \n성별: 여성  \n\nFocus: 아침 식후 고혈당 관리  \n\nData:\n 환자는 1 형 당뇨병으로 인해 입원 중이며, 아침 식후 혈당이 정상 범위를 벗어나고 있음.\n 아침 식후 혈당 수치는 200 mg/dL로 측정되었으며, 환자는 피로와 두통을 호소함.\n 환자는 혈당 증가와 관련된 불쾌한 증상을 경험하며, 혈당 관리에 대한 지속적인 교육이 필요함.\n 식후 혈당 관리 목표치는 180 mg/dL 이하이며, 환자는 자가 주사를 통한 인슐린 치료를 받고 있음.\n\nAction:\n1. 아침 식후 혈당 수치를 확인하고, 의사의 지시에 따라 인슐린 치료 계획을 조절.\n2. 환자의 식사 습관과 양을 평가하고, 영양사와의 협력을 통해 혈당 조절을 위한 식이요법 수립.\n3. 혈당 감시를 위해 자주 혈당을 측정하고, 그 결과를 기록하여 혈당 변화 추이를 지속적으로 평가.\n4. 환자에게 혈당 관리의 중요성과 식후에 발생할 수 있는 증상에 대한 교육 제공.\n5. 환자와의 대화를 통해 혈당 관리에 대한 이해도를 확인하고, 필요 시 자가모니터링 기술 사용법 교육.\n\nResponse:\n 인슐린 치료 계획을 조절한 결과, 아침 식후 혈당이 200 mg/dL에서 160 mg/dL로 감소함.\n 혈당 감시를 통해 혈당 변화를 지속적으로 평가하고, 조정된 혈당 관리 계획에 따라 안정적인 혈당 수치를 유지함.\n 환자의 식사 습관과 양을 조절하여 혈당 조절에 기여하고, 영양사와의 협력을 통해 식이요법을 개선함.\n 환자는 혈당 관리에 대한 이해도가 높아져 자가모니터링을 적극적으로 실시하며, 혈당 조절에 적극적으로 참여함.\n 향후 혈당 관리 교육과 지속적인 평가를 통해 환자의 당뇨 관리를 지원함."},
    {"input": "양쪽 무릎 NRS 6점 환자의 간호기록을 Focus DAR 양식으로 작성해줘.", "output": "환자 정보:\n이름: 박서진  \n나이: 55세  \n성별: 남성  \n\nFocus: 양쪽 무릎 NRS(무릎 통증) 6점  \n\nData:\n 환자는 최근에 양쪽 무릎에서 지속적인 통증을 경험하고 있으며, NRS(무릎 통증)로 6점의 강도로 평가됨.\n 통증은 특히 오랫동안 앉아 있거나 일어날 때 더 심해지는 경향이 있음.\n 환자는 통증으로 인해 산책이나 계단 오르내리기가 어려워지고, 휴식을 취하더라도 효과가 미미함.\n 통증의 특징은 '무거워지고 쑤시는' 느낌으로 표현되며, 무릎을 굽히거나 펴는 것이 힘들어짐.\n\nAction:\n1. 무릎 통증의 원인을 확인하기 위해 의사의 진찰을 의뢰하고, 필요 시 무릎 관절 관련 검사를 실시하여 진단.\n2. 현재의 통증을 완화하기 위해 의사의 처방에 따라 통증 완화제 및 항염증제 처방.\n3. 물리치료사와의 협력을 통해 무릎 근육의 강도 및 유연성을 향상시키는 운동 프로그램 개발.\n4. 통증의 강도와 발생 패턴을 정확히 기록하고, 통증 완화제 투여 후 효과를 평가하여 처방 조절.\n5. 환자에게 통증 관리에 대한 교육을 제공하고, 자가 돌봄 기술 강화를 위한 지원 및 정보 제공.\n\nResponse:\n 의사의 진찰 결과, 양쪽 무릎의 통증은 연골 손상으로 확인되어 적절한 치료 시작.\n 통증 완화제와 항염증제의 투여로 통증의 강도가 6점에서 2점으로 감소하며, 일상 생활에 대한 제한이 완화됨.\n 물리치료를 통해 무릎 근육의 강도 및 유연성이 향상되어 보행이 수월해지고, 환자의 활동량이 증가함.\n 환자는 통증 관리에 대한 이해도가 높아져 처방된 치료 계획에 적극적으로 협력함.\n 향후 의사의 지시에 따라 정기적인 추적 관찰과 평가를 통해 치료 효과를 모니터링함."},
    {"input": "통증관리 환자의 간호기록을 Focus DAR 양식으로 작성해줘.", "output": "환자 정보:\n이름: 박준혁  \n나이: 60세  \n성별: 남성  \n\nFocus: 류마티스 관절염으로 인한 관절 통증  \n\nData:\n 환자는 몇 년 동안 류마티스 관절염으로 인한 관절 통증을 경험하고 있으며, 현재 통증의 강도는 NRS로 7점으로 평가됨.\n 통증은 주로 어깨, 팔꿈치, 무릎 관절에 집중되어 있으며, 특히 아침에 일어날 때 더욱 뚜렷해짐.\n 환자는 통증으로 인해 일상 생활에서의 활동이 제한되고, 특히 계단 오르내릴 때 통증이 증가함.\n 현재까지 다양한 약물 치료 및 물리치료를 시도하였으나, 효과가 미미함.\n\nAction:\n1. 의사의 진찰을 의뢰하여 류마티스 관절염의 활동성 및 관절 손상 정도를 평가하고, 현재 통증에 대한 적절한 치료 계획 수립.\n2. 통증 강도와 위치를 정확히 기록하고, 의사의 처방에 따라 통증 완화제 및 면역억제제 등의 약물 처방.\n3. 물리치료사와의 협력을 통해 관절을 안정시키고, 관절 운동 범위를 확대하는 운동 프로그램 실시.\n4. 환자에게 통증 관리 전략에 대한 교육을 제공하고, 자가 돌봄 기술 강화를 위한 지원 및 정보 제공.\n5. 통증의 강도와 관절 상태를 정기적으로 평가하고, 의사와 함께 치료 계획을 조절하여 효과적인 통증 관리.\n\nResponse:\n 의사의 진찰 결과, 류마티스 관절염의 활동성이 높아\n\n 관절 손상이 진행되고 있음을 확인하고, 적절한 치료 시작.\n 통증 완화제와 면역억제제의 투여로 통증의 강도가 7점에서 2점으로 감소하며, 환자의 일상 생활에 대한 제약이 완화됨.\n 물리치료를 통해 관절의 안정성이 향상되어 관절 운동 범위가 확대되고, 환자의 활동 능력이 향상됨.\n 환자는 통증 관리에 대한 이해도가 높아져 처방된 치료 계획에 적극적으로 협력함.\n 향후 의사의 지시에 따라 정기적인 추적 관찰과 평가를 통해 치료 효과를 모니터링함."},
    {"input": "성인욕창 및 낙상 위험 환자의 간호기록을 Focus DAR 양식으로 작성해줘.", "output": "환자 정보:\n이름: 박지영  \n나이: 68세  \n성별: 여성  \n\nFocus: 성인 욕창 및 낙상 위험  \n\nData:\n 환자는 상태 악화로 침상이 필요한 상태로 입원 중이며, 성인 욕창의 위험성이 높음.\n 초기 피부 평가에서 엉덩이와 고관절 부위에서 붉은 색 변화가 확인되었으며, 피부 표면이 부어있어 부드럽게 느껴짐.\n 환자는 앓고 있는 질환으로 인해 움직이는 것이 어려우며, 체중 감소와 기능 저하로 일상 생활에서의 활동이 제한되어 있음.\n 낙상 위험 평가에서는 환자가 이동할 때나 일어서는 동안에 균형을 유지하기 어려운 상태임.\n\nAction:\n1. 피부 상태를 정기적으로 모니터링하고, 압력을 최소화하는 쿠션 및 매트리스 사용을 통해 예방 조치 실시.\n2. 간호사와 물리치료사의 협력을 통해 환자의 체위를 주기적으로 변경하고, 체중 감소를 방지하는 치료 계획 수립.\n3. 보조 기구 사용 교육 및 환자의 이동과 관련된 안전한 기술을 학습시켜 낙상 위험을 최소화.\n4. 가족이나 보호자에게 환자의 침상 상태와 이동에 대한 지속적인 감독을 부탁하고, 낙상 예방을 위한 환경 개선 교육.\n5. 의사와 협력하여 기저질환의 치료 및 영양 상태를 개선하고, 환자의 일상 활동 수행을 지원하는 종합적인 치료 전략 수립.\n\nResponse:\n 피부 상태의 모니터링 결과, 초기에 발견된 압력 점의 피부 변화가 예방 조치를 통해 호전되었음.\n 쿠션 및 매트리스의 사용으로 피부의 부종이 감소하고, 피부\n\n 표면이 부드럽게 회복되었음.\n 환자는 적절한 기술을 사용하여 침상 및 이동 중의 낙상 위험을 효과적으로 관리함.\n 보조기구 사용과 환경 개선을 통해 낙상 위험이 최소화되어, 환자의 일상 활동 수행이 안전하게 이루어지고 있음.\n 가족 및 보호자는 환자의 침상과 이동에 대한 지속적인 감독을 수행하고, 응급 상황 시 신속한 조치를 취할 수 있는 능력을 향상시켰음."},
    {"input": "자발적 환기 장애 환자의 간호기록을 Focus DAR 양식으로 작성해줘.", "output": "환자 정보:\n이름: 송지영  \n나이: 58세  \n성별: 여성  \n\nFocus: 자발적 환기 장애  \n\nData:\n 환자는 몇 주 동안 호흡 곤란과 기침 증상을 호소하며, 특히 활동 중에 호흡 어려움을 느끼고 있음.\n 가래의 색상이 짙어지고 양이 증가하며, 흡입음과 함께 호흡 소리가 높게 들림.\n 측정된 산소 포화도는 88%로 낮아, 활동량 제약 및 휴식 중에도 호흡 어려움을 지속적으로 경험함.\n 환자는 과거에 만성 폐쇄성 폐질환(COPD) 진단을 받은 경험이 있으며, 이전에 처방받은 약물 복용 중.\n\nAction:\n1. 의사의 진찰을 의뢰하여 폐 기능 테스트 및 혈액 검사 등을 통해 자발적 환기 장애의 원인을 확인.\n2. 의사의 처방에 따라 기존 약물 조절 및 새로운 기관지 확장제와 멀티 드러그 치료법을 포함한 복합적 치료 시행.\n3. 호흡기 전문가와의 협력을 통해 호흡 기술 교육 및 폐 기능을 향상시키는 운동 프로그램 개발.\n4. 환자의 호흡 상태를 정확하게 모니터링하고, 산소 포화도, 가래의 양, 호흡 소리 등을 기록하여 치료 효과를 평가.\n5. 환자와 가족에게 자발적 환기 개선을 위한 실질적인 자가 돌봄 기술을 교육하고, 긴급 상황 시 대처 방법에 대한 정보 제공.\n\nResponse:\n 의사의 진찰 결과, 환자는 COPD의 악화로 인한 자발적 환기 장애로 확인되어 조절된 치료 계획 시작.\n 조절된 약\n\n물 투여로 호흡 어려움이 감소하고, 산소 포화도가 안정화되며, 가래의 양도 감소함.\n 호흡기 전문가와의 협력을 통해 환자는 효과적인 호흡 기술을 습득하고, 일상 생활에서의 활동량이 증가함.\n 환자는 정기적인 의료진의 평가와 함께 자가 모니터링을 통해 증상을 효과적으로 관리하고 있음.\n 향후 정기적인 치료 계획 검토와 필요 시 조절을 위해 의사와의 계속된 협력이 예정됨."},
    {"input": "급성통증 환자의 간호기록을 Focus DAR 양식으로 작성해줘.", "output": "환자 정보:\n이름: 박승민  \n나이: 45세  \n성별: 남성  \n\nFocus: 급성 허리 통증  \n\nData:\n 환자는 최근에 무거운 물건을 들다가 허리를 다쳐 급성 허리 통증을 호소함.\n 통증은 허리 부위에서 시작되어 다리로 퍼지며, 특히 일어나거나 앉을 때, 또는 움직일 때 통증이 증가함.\n 통증의 강도는 NRS로 7점으로 나타나며, 허리와 다리 부위에서 극심한 긴장 및 뻐근함이 느껴짐.\n 환자는 허리를 휴식시켜도 통증이 완화되지 않아 활동이 제한되고 있음.\n\nAction:\n1. 의사의 지시에 따라 급성 허리 통증에 대한 정확한 평가를 수행하고, 필요한 영상 검사 및 진단 확인.\n2. 통증의 강도와 패턴을 정확히 기록하고, 특히 일상 생활에서 어떤 동작이나 자세에서 통증이 발생하는지 상세하게 기\n\n술.\n3. 허리와 다리 부위의 긴장 및 뻐근함을 정기적으로 모니터링하고, 필요 시 물리치료사와 협력하여 근육 강화 및 스트레칭 프로그램 실시.\n4. 통증 관리를 위해 의사의 처방에 따라 진통제 및 근육 이완제 투여.\n5. 환자에게 효과적인 휴식과 허리 보호를 위한 자세 교정 및 운동 교육을 제공.\n\nResponse:\n 정확한 평가를 통해 허리 부위의 손상이 확인되었고, 의사의 처방에 따라 치료 계획이 수립되어 진통제 및 근육 이완제의 투여로 통증이 감소.\n 물리치료를 통해 근육 강화 및 스트레칭이 이루어져 허리와 다리 부위의 긴장 및 뻐근함이 감소함.\n 환자는 효과적인 휴식과 허리 보호를 위한 자세 교정 및 운동에 적극 협조하고 있음.\n 향후의 관찰과 치료 계획에 따라 통증이 완전히 호전되도록 모니터링이 계속됨."},
    {"input": "고체온 환자의 간호기록을 Focus DAR 양식으로 작성해줘.", "output": "환자 정보:\n이름: 정현우  \n나이: 70세  \n성별: 남성  \n\nFocus: 고열 및 간질 증상  \n\nData:\n 환자는 고열과 갑작스러운 간질 증상을 호소함.\n 체온: 38.9°C\n 간질 발작은 5분 동안 지속되며, 의식이 잠시동안 소실됨.\n 혈압: 140/90 mmHg\n 심박수: 95 bpm\n 호흡수: 18 rpm\n 환자는 간질 후 혼란스러움을 호소하며, 기억상실 증상이 있음.\n\nAction:\n1. 고열 및 간질 관리를 위해 의사의 지시에 따라 강력한 해열제 및 항간질제 투여.\n2. 간질 예방을 위해 의사의 처방에 따라 항간질제 복용 지속 및 혈중 농도 모니터링.\n3. 간질 발작 중에는 환자의 안전을 위해 안전벨트 등을 활용하여 보호.\n4. 간질 상태 및 고열에 대한 추가적인 검사를 실시하고, 의사에게 결과 보고.\n5. 환자와 가족에게 간질의 예방 및 응급 상황 대처 방법에 대한 교육 제공.\n\nResponse:\n 해열제 및 항간질제 투여로 체온이 37.0°C로 정상화되며, 간질 발작 빈도가 감소함.\n 안전벨트를 활용하여 간질 발작 중에도 환자의 안전을 유지하고, 부상 예방에 효과적.\n 추가적인 검사 결과를 토대로 간질의 원인을 확인하고, 적절한 치료 계획이 수립됨.\n 환자와 가족은 간질의 예방 및 응급 상황에 대한 이해가 높아져 자가 관리 능력이 향상됨."},
    {"input": "분만통증 환자의 간호기록을 Focus DAR 양식으로 작성해줘.", "output": "환자 정보:\n이름: 박지영  \n나이: 29세  \n성별: 여성  \n\nFocus: 자연분만을 통한 분만 통증 관리  \n\nData:\n 환자는 현재 40주에 입성한 임신부로, 분만을 위해 입원 중이며, 자연분만을 통한 분만을 계획하고 있음.\n 환자는 활발한 자궁 수축과 함께 통증을 경험하며, 수축 간격이 점차 감소함.\n 통증은 허리와 하복부에서 시작되어 전체 복부로 확산되며, 특히 수축이 강할 때 가장 강한 통증을 느끼고 있음.\n 통증의 강도는 Visual Analog Scale (VAS)로 7점으로 평가되며, 통증에 동반되는 호흡 곤란 및 긴장감이 느껴짐.\n 환자는 통증 경험을 통해 진통제의 최소한 사용을 원하고, 호흡 및 안정적인 분만을 위해 노력하고 있음.\n\nAction:\n1. 간호진은 환자의 통증 경험을 정확히 기록하고, 자연분만을 통한 분만 통증 관리 계획 수립.\n2. 통증의 강도 및 느낌을 정확히 기록하고, 특히 수축과 통증 간의 관계를 분석하여 최적의 관리 전략을 찾음.\n3. 호흡 및 안정적인 분만을 위한 노력에 대한 교육을 실시하여 환자가 효과적인 통증 관리를 위한 기술을 습득.\n4. 환자와 동반자에게 분만 도중에 사용될 수 있는 다양한 자연적인 진통법에 대한 안내와 교육을 제공.\n5. 의사와 협력하여 필요한 경우 통증을 완화하기 위한 자연적인 방법 및 안정적인 분만을 위한 추가적인 지원을 고려.\n\nResponse:\n 간호진의 지원과 교육 덕분에 환자는 호흡 및 안정적인 분만을 위한 노력을 효과적으로 시도하며, 통증을 일부 완화함.\n 통증의 강도와 느낌을 정확히 기록하여 간호진은 최적의 통증 관리 전략을 수립하고 조절함.\n 환자는 진통제의 최소한 사용을 원하며, 활용 가능한 다양한 자연적인 진통법을 통해 통증을 완화하는 방법을 습득함.\n 분만 도중에는 환자와 동반자가 원하는 통증 관리 방법이 존중되며, 자연분만의 경험을 긍정적으로 향상시킴.\n 향후의 관찰과 협력을 통해 환자의 통증 경험이 최대한 존중되고"},
    {"input": "입원관리 환자의 간호기록을 Focus DAR 양식으로 작성해줘.", "output": "환자 정보:\n이름: 박민서  \n나이: 70세  \n성별: 남성  \n\nFocus: 만성 심부전으로 인한 입원 관리  \n\nData:\n 환자는 만성 심부전으로 인해 호흡 곤란 및 부종 증상으로 입원 중이며, 현재 심박출률은 30%로 낮게 나타남.\n 과거 의료 기록에서는 심부전 관리를 위해 다양한 심장약물을 복용 중이었으나, 최근 몇 주 동안 증상이 악화되고 있음.\n 환자는 흉통, 발바닥의 부종, 하품 및 현기증을 호소하며, 특히 누워 있는 동안 호흡 곤란을 느끼고 있음.\n 의사의 지시에 따라 산소 치료 및 다양한 심장약물의 조절이 이루어지고 있으며, 간호진은 정기적인 심전도 및 산소 포화도 모니터링을 수행.\n\nAction:\n1. 의사의 지시에 따라 심장약물의 조절 및 신규 치료 옵션을 검토하여 환자의 심부전 관리 계획을 최적화.\n2. 심부전 관리를 위한 저나트륨 식단 및 수\n\n방 침상 등의 환경적 조치를 실시하여 부종 증상 완화.\n3. 호흡곤란 및 산소포화도의 변화를 정기적으로 모니터링하고, 의사와 협력하여 필요 시 산소 치료 조절.\n4. 환자의 신체 활동 능력에 따라 물리치료사와 협력하여 신체 기능 유지 및 회복을 위한 운동 프로그램 개발.\n5. 환자와 가족에게 심부전에 대한 교육을 제공하고, 퇴원 후의 치료 계획 및 자가 돌봄 계획을 수립.\n\nResponse:\n 최적화된 심부전 관리 계획에 따라 환자의 심박출률이 30%에서 40%로 상승하며, 호흡 곤란과 부종 증상이 감소됨.\n 환자는 신규 치료 옵션과 저나트륨 식단을 통해 증상이 완화되어 호흡 곤란이 감소하고 편안한 휴식을 취할 수 있게 됨.\n 신체 기능 유지를 위한 물리치료와 운동 프로그램을 통해 환자의 활동 능력이 일부 회복되어 자립적인 일상 생활이 가능.\n 환자와 가족은 심부전에 대한 이해도가 높아져 퇴원 후의 자가 돌봄에 대비하며, 응급 상황 시 적절한 조치를 할 수 있는 능력이 향상됨."},
]



# FewShotChatMessagePromptTemplate 인스턴스 생성
few_shot_prompt = FewShotChatMessagePromptTemplate(
    example_prompt=example_prompt,
    examples=examples
)

# 추가 지침
instruction = """
You are a nurse working in a general hospital. Answer the question, adhering to the following guidelines:
1. Write in Korean
2. Utilize the information available in the prompt. If relevant information is not found there, then seek answers through other channels.
3. Use precise and concise language. Use endings like 음, 함, 임.
4. Fill out patient information in order
5. Necessary to include "Focus", "데이터(Data)", "활동(Action)","반응(Response)"
6. Create a fictional patient's information.
7. Be as specific as possible.
8. Record precise measurements.
9. Use bullet points for the description instead of using numeric order.
10.Fill in the patient's name, age, and gender, but no other personal information.
11. Give it a different name ex) 김현중, 구진성, 홍선우, 조아라, 최승우, 남하늘, 신영태...
"""



# 최종 프롬프트 템플릿 생성
final_prompt = ChatPromptTemplate.from_messages(
    [
        ("system", instruction),
        ("human", "{input}"),
        ("ai", "{output}"),
    ]
)

# 사용자 질문
# user_question = "지주막하 출혈(Traumatic SAH, Hemorrhage)에 대한 간호기록을 NANDA형식으로 작성해줘"
# message = HumanMessage(content=user_question)

# 체인 구성
chain = final_prompt | chat

# CSV 파일에서 데이터 불러오기
df = pd.read_csv("fix_csvfile\\FOCUS_cleaned.csv")

# 새로운 데이터셋
new_dataset = []

# 각 행 처리
for index, row in df.iterrows():
    user_question = row['disease name'], "환자의 간호기록 Focus DAR 양식으로 작성해줘."  # CSV 파일의 'input' 열에서 질문을 가져옴
    message = HumanMessage(content=user_question)
    response = chain.invoke({"input": user_question, "output": ""})
    new_dataset.append({'input': user_question, 'output': response.content})
    print(response)

# 새로운 데이터셋을 DataFrame으로 변환
new_df = pd.DataFrame(new_dataset)

# 새로운 데이터셋을 CSV 파일로 저장
new_df.to_csv("저장경로", index=False, encoding='utf-8')
